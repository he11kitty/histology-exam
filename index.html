<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Histology — Full Exam (200 items)</title>
<style>
  :root{
    --bg:#071027; --card:#0b1220; --muted:#9aa6b2;
    --accent:#6ee7b7; --danger:#ff7a7a; --success:#8ee07b;
    --glass: rgba(255,255,255,0.03);
    font-family: Inter, Roboto, Arial, sans-serif;
  }
  html,body{height:100%;margin:0;background:
    linear-gradient(180deg,#071027 0%, #07172a 45%, #071a2c 100%);
    color:#e6eef3;-webkit-font-smoothing:antialiased}
  .container{max-width:1200px;margin:24px auto;padding:18px;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;gap:16px}
  header h1{font-size:20px;margin:0;color:var(--accent)}
  .controls{display:flex;gap:8px;align-items:center}
  button{background:linear-gradient(180deg, #0f1724, #071122);border:1px solid rgba(255,255,255,0.06);
    color:var(--accent);padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  button.small{padding:6px 10px;font-size:13px}
  .exam-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);border-radius:12px;padding:16px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
  .meta{display:flex;gap:12px;align-items:center;color:var(--muted);margin-bottom:8px}
  .progress{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:999px;font-weight:700;color:var(--accent)}
  .score{background:rgba(0,0,0,0.2);padding:8px 12px;border-radius:999px}
  .questions{margin-top:10px}
  .question{background:var(--glass);border-radius:10px;padding:12px;margin-bottom:10px;border:1px solid rgba(255,255,255,0.03)}
  .qhead{display:flex;align-items:flex-start;gap:10px}
  .qnum{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);font-weight:800;color:var(--accent)}
  .qtext{flex:1}
  .opts{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
  .opt{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;cursor:pointer;color:#cfeff1;font-weight:600;transition:all .18s}
  .opt:hover{transform:translateY(-3px)}
  .opt.correct{background:linear-gradient(90deg,#04482a,#0a7b4f);border-color:rgba(0,0,0,0.3);color:#eafff3}
  .opt.incorrect{background:linear-gradient(90deg,#5b1b1b,#ff6b6b);border-color:rgba(0,0,0,0.3)}
  .rationale{margin-top:10px;padding:12px;border-radius:8px;background:rgba(0,0,0,0.25);color:#cfeff1;display:none;white-space:pre-wrap;font-size:14px;line-height:1.45}
  .rationale.show{display:block}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px;color:var(--muted)}
  .brand{font-size:12px}
  .legend{display:flex;gap:8px;align-items:center}
  .legend .box{width:14px;height:14px;border-radius:3px;display:inline-block}
  .box.green{background:linear-gradient(90deg,#0bb07a,#58f2a7)}
  .box.red{background:linear-gradient(90deg,#ff6b6b,#ffb2b2)}
  .top-actions{display:flex;gap:8px}
  aside#quiz-catalog{box-shadow:0 6px 30px rgba(2,6,23,0.2);padding:12px;border-radius:10px;min-height:120px;min-width:260px}
  .quiz-entry{padding:8px 6px;border-bottom:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .quiz-entry:hover{background:rgba(255,255,255,0.01)}
  @media(max-width:900px){
    .opts{grid-template-columns:1fr}
    header{flex-direction:column;align-items:flex-start;gap:8px}
    .layout{flex-direction:column}
    aside#quiz-catalog{width:100%;float:none;margin-bottom:12px}
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1 id="pageTitle">Histology — Full Exam (200 items)</h1>
    </div>
    <div class="controls">
      <div class="meta">
        <div class="progress" id="progress">Answered: 0 / 200</div>
        <div class="score" id="score">Score: 0</div>
      </div>
      <div class="top-actions">
        <button id="showScore" class="small">Show Score</button>
        <button id="resetBtn" class="small">Reset</button>
      </div>
    </div>
  </header>

  <div class="layout" style="display:flex;gap:16px;align-items:flex-start">
    <aside id="quiz-catalog" aria-label="Available Exams">
      <!-- Catalog entries injected here -->
    </aside>

    <div class="exam-card" style="flex:1">
      <div class="questions" id="questions"></div>
      <div class="footer">
        <div class="brand">Rationales: explanation → (no source shown) → distractor explanations</div>
        <div class="legend">
          <span style="color:var(--muted);font-size:13px;margin-right:8px">Legend</span>
          <span class="box green"></span><span style="color:var(--muted);margin-right:10px">= correct</span>
          <span class="box red"></span><span style="color:var(--muted)">= incorrect</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* Single-file histology exam with 200 questions and EVALS-style rationales.
   This replaces the entire site. Paste the full HTML into index.html and commit.
*/

const quizzes = {
  histology: {
    id: "histology",
    title: "Histology — Full Exam (200 items)",
    questions: [
      {"q":"The resolving power of a light microscope (LM) is approximately:","options":["0.2 nm","0.2 μm","2 μm","200 μm"],"correct":1,"rationale":"Light microscopes resolving power is around 0.2 μm (200 nm) because of the wavelength limits of visible light; electron microscopes resolve much smaller detail."},
      {"q":"Which objective is typically used for scanning a slide?","options":["100× oil immersion","40× high power","4× scanning","10× low power"],"correct":2,"rationale":"Scanning objectives are low-power (about 4×) to survey the slide; higher objectives are for detailed viewing."},
      {"q":"Which stain demonstrates reticular fibers (argyrophilic)?","options":["PAS","H&E","Best's carmine","Silver stain"],"correct":3,"rationale":"Reticular fibers are argyrophilic and commonly visualized by silver stains; PAS highlights carbohydrates and H&E is a general stain."},
      {"q":"Total magnification equals:","options":["objective × condenser","ocular ÷ objective","objective × eyepiece","eyepiece + condenser"],"correct":2,"rationale":"Total magnification equals objective magnification multiplied by eyepiece magnification."},
      {"q":"TEM is best for:","options":["3D surface imaging","Internal ultrastructure (2-D)","Low-resolution color imaging","Macroscopic anatomy"],"correct":1,"rationale":"TEM offers high-resolution two-dimensional images of internal ultrastructure; SEM is for surface topography."},
      {"q":"Which organelle contains extranuclear DNA?","options":["Lysosome","Peroxisome","Mitochondrion","Ribosome"],"correct":2,"rationale":"Mitochondria have their own circular DNA (mtDNA) separate from nuclear DNA, supporting some independent protein synthesis."},
      {"q":"Nissl bodies are:","options":["Smooth ER","Golgi apparatus","RER and ribosomes","Mitochondria"],"correct":2,"rationale":"Nissl bodies are rough endoplasmic reticulum with ribosomes, indicating neurons' high protein synthesis capacity."},
      {"q":"Anterograde axonal transport uses:","options":["Dynein","Kinesin","Myosin","Actin"],"correct":1,"rationale":"Kinesin mediates anterograde transport toward the synapse; dynein is retrograde motor toward the cell body."},
      {"q":"Intermediate filaments diameter ~:","options":["5 nm","10 nm","25 nm","100 nm"],"correct":1,"rationale":"Intermediate filaments have a diameter of ~10 nm and give mechanical stability to cells."},
      {"q":"The unit membrane is:","options":["Only nuclear membrane","Trilaminar appearance of membranes","Protein coat of ribosomes","Cytoskeletal filaments"],"correct":1,"rationale":"Unit membrane describes the trilaminar appearance of biological membranes under EM."},
      {"q":"Glycocalyx is composed mainly of:","options":["Intracellular proteins","Nucleic acids","Glycolipids/glycoproteins","Collagen fibers"],"correct":2,"rationale":"The glycocalyx is formed by carbohydrate moieties of membrane glycoproteins and glycolipids projecting from the cell surface."},
      {"q":"Basal lamina is produced by:","options":["Fibroblasts","Epithelial cells","Endothelium only","Macrophages"],"correct":1,"rationale":"Epithelial cells synthesize basal lamina components, including laminin and type IV collagen."},
      {"q":"Main collagen-producing cell:","options":["Chondrocyte","Macrophage","Fibroblast","Osteoclast"],"correct":2,"rationale":"Fibroblasts synthesize collagen and extracellular matrix in connective tissues."},
      {"q":"Hyaluronic acid functions to:","options":["Cross-link collagen","Form proteoglycan backbone and bind water","Make elastic fibers","Form membranes"],"correct":1,"rationale":"Hyaluronic acid forms the backbone of proteoglycan aggregates and holds water, creating a gel-like ground substance."},
      {"q":"Reticular fibers are mostly:","options":["Type I collagen","Elastin","Type III collagen","Keratin"],"correct":2,"rationale":"Reticular fibers consist mainly of type III collagen and form supporting networks in soft tissues."},
      {"q":"Tropoelastin polymerizes to form:","options":["Collagen fibrils","Elastin","Reticular fibers","Proteoglycans"],"correct":1,"rationale":"Tropoelastin polymerizes and cross-links into elastin, the protein core of elastic fibers."},
      {"q":"Principal tendon protein:","options":["Elastin","Type II collagen","Type I collagen","Proteoglycan"],"correct":2,"rationale":"Type I collagen provides tensile strength to tendons and is the major structural protein."},
      {"q":"Proteoglycans provide:","options":["Tensile strength","Gel-like ground substance binding water","Make elastin","Membrane receptors"],"correct":1,"rationale":"Proteoglycans retain water and give the extracellular matrix a gel-like consistency that resists compression."},
      {"q":"Elastic cartilage identified by:","options":["Type II collagen only","Abundant elastic fibers","Absence of chondrocytes","Same as fibrocartilage"],"correct":1,"rationale":"Elastic cartilage contains abundant elastic fibers giving it flexibility; seen in external ear and epiglottis."},
      {"q":"Zone of hypertrophy in growth plate shows:","options":["Resting cells","Proliferating columns","Enlarged chondrocytes","Bone formation only"],"correct":2,"rationale":"The hypertrophic zone contains enlarged chondrocytes that later calcify and are replaced by bone."},
      {"q":"Cell that resorbs bone:","options":["Osteoblast","Osteocyte","Osteoclast","Osteoprogenitor"],"correct":2,"rationale":"Osteoclasts are large multinucleated cells specialized for bone resorption with a ruffled border."},
      {"q":"Transitional epithelium superficial cells are:","options":["Goblet cells","Basal cells","Umbrella cells","Keratinocytes"],"correct":2,"rationale":"Umbrella cells are large superficial cells in urothelium that form a barrier and accommodate stretch."},
      {"q":"Keratohyalin granules appear in:","options":["Stratum basale","Stratum spinosum","Stratum granulosum","Stratum corneum"],"correct":2,"rationale":"Stratum granulosum contains keratohyalin granules important for keratin aggregation and barrier formation."},
      {"q":"Light cells of eccrine sweat glands secrete:","options":["Protein component","Water/glycogen-rich secretion","Sebum","Keratin"],"correct":1,"rationale":"Light cells secrete the watery component of eccrine sweat and contain glycogen."},
      {"q":"Meissner corpuscles detect:","options":["Deep pressure","Light touch in papillary dermis","Temperature","Pain"],"correct":1,"rationale":"Meissner corpuscles in dermal papillae detect fine touch and texture in glabrous skin."},
      {"q":"Keratinocytes synthesize:","options":["Collagen","Elastin","Keratin","Actin"],"correct":2,"rationale":"Keratinocytes produce keratin as they mature, forming the protective epidermal barrier."},
      {"q":"Sebaceous glands secrete by:","options":["Merocrine","Apocrine","Holocrine","Endocrine"],"correct":2,"rationale":"Sebaceous glands use holocrine secretion, releasing whole cell contents (sebum)."},
      {"q":"Hexagonal arrangement in muscle: how many thin filaments around a thick filament?","options":["3","4","6","8"],"correct":2,"rationale":"In skeletal muscle each thick filament is surrounded in a hexagonal lattice by six thin filaments."},
      {"q":"Sarcoplasmic triad comprises:","options":["T-tubule + 2 terminal cisternae","One T-tubule","3 mitochondria","Sarcolemma + nucleus"],"correct":0,"rationale":"A triad is a T-tubule flanked by two terminal cisternae of the sarcoplasmic reticulum, important for excitation-contraction coupling."},
      {"q":"Cardiac intercalated discs contain:","options":["Only gap junctions","Fasciae adherens, desmosomes and gap junctions","Only desmosomes","Only fasciae adherens"],"correct":1,"rationale":"Intercalated discs have transverse components (fasciae adherens and desmosomes) and lateral gap junctions for mechanical and electrical coupling."},
      {"q":"Smooth muscle lacks:","options":["Dense bodies","Troponin","Actin","Myosin"],"correct":1,"rationale":"Smooth muscle lacks troponin; contraction regulation uses calmodulin and dense bodies anchor thin filaments."},
      {"q":"Oligodendrocytes:","options":["Myelinate single PNS axon","Myelinate multiple CNS axons","Are immune cells","Form the blood-brain barrier"],"correct":1,"rationale":"Oligodendrocytes myelinate multiple CNS axons, unlike Schwann cells in the PNS."},
      {"q":"Microglia derive from:","options":["Neural crest","Epithelial cells","Monocyte/macrophage lineage","Schwann cells"],"correct":2,"rationale":"Microglia derive from hematopoietic monocyte lineage and function as immune cells in CNS."},
      {"q":"Nissl substance is absent from:","options":["Dendrites","Perikaryon","Axon hillock/axon","Soma"],"correct":2,"rationale":"Nissl substance (rER) is absent in the axon and axon hillock, where protein synthesis is minimal."},
      {"q":"Nodes of Ranvier are:","options":["Continuous myelin","Sites of neurotransmitter release","Gaps in myelin between internodes","Glial cell bodies"],"correct":2,"rationale":"Nodes of Ranvier are gaps between myelinated internodes allowing saltatory conduction."},
      {"q":"Glia limitans is formed by:","options":["Oligodendrocytes","Protoplasmic astrocytes","Microglia","Fibroblasts"],"correct":1,"rationale":"Astrocytic endfeet contribute to the glia limitans beneath the pia mater."},
      {"q":"Which bone cell responds to PTH by stimulating osteoclasts?","options":["Osteoprogenitor","Osteoblast","Osteocyte","Chondrocyte"],"correct":1,"rationale":"Osteoblasts produce RANKL and other factors that stimulate osteoclast formation under PTH influence."},
      {"q":"Hyaline cartilage matrix is rich in:","options":["Type I collagen","Type II collagen and proteoglycans","Keratin","Fibrillin"],"correct":1,"rationale":"Hyaline cartilage has abundant type II collagen and a proteoglycan-rich ground substance, providing resilience."},
      {"q":"Elastic cartilage is characterized by:","options":["Absence of chondrocytes","Abundant elastic fibers","Predominant type I collagen","Being vascular"],"correct":1,"rationale":"Elastic cartilage contains many elastic fibers, visible with special stains, providing flexibility."},
      {"q":"The stratum basale of epidermis contains:","options":["Mitosis and basal keratinocytes","Dead squames","Melanocytes only","No cell turnover"],"correct":0,"rationale":"Stratum basale contains proliferative basal keratinocytes and melanocytes, responsible for epidermal renewal."},
      {"q":"Melanocytes originate from:","options":["Endoderm","Neural crest","Mesoderm","Ectodermal surface"],"correct":1,"rationale":"Melanocytes derive from neural crest cells and migrate into the epidermis to produce melanin."},
      {"q":"Langerhans cells function as:","options":["Keratin-producing cells","Dendritic antigen-presenting cells","Sebum-secreting cells","Melanin synthesizers"],"correct":1,"rationale":"Langerhans cells are epidermal dendritic cells that process and present antigen to T cells."},
      {"q":"Which gland is merocrine?","options":["Sebaceous gland","Eccrine sweat gland","Apocrine sweat gland","Mammary gland"],"correct":1,"rationale":"Eccrine sweat glands secrete via merocrine mechanism (exocytosis) producing watery sweat."},
      {"q":"Which receptor senses deep pressure and vibration?","options":["Meissner corpuscle","Pacinian corpuscle","Merkel cell","Ruffini ending"],"correct":1,"rationale":"Pacinian corpuscles (lamellar corpuscles) are mechanoreceptors sensitive to deep pressure and vibration."},
      {"q":"Keratin filaments are made of:","options":["Actin","Tubulin","Keratin proteins","Collagen"],"correct":2,"rationale":"Keratin intermediate filaments are composed of keratin proteins providing mechanical strength to epithelial cells."},
      {"q":"Which bone formation mechanism uses a cartilage model?","options":["Intramembranous ossification","Endochondral ossification","Appositional growth","Bone remodeling"],"correct":1,"rationale":"Endochondral ossification replaces a hyaline cartilage model with bone, as in long bones."},
      {"q":"In skeletal muscle, sarcomeres are bounded by:","options":["A bands","I bands","Z discs","M lines"],"correct":2,"rationale":"Z discs delimit sarcomeres, which contain ordered A and I bands between Z discs."},
      {"q":"Which intercellular junction prevents paracellular diffusion?","options":["Desmosome","Gap junction","Tight junction (zonula occludens)","Adherens junction"],"correct":2,"rationale":"Tight junctions (zonula occludens) create a seal between epithelial cells preventing paracellular passage."},
      {"q":"Which collagen type is found in basement membranes?","options":["Type I","Type II","Type IV","Type III"],"correct":2,"rationale":"Type IV collagen is a major component of basement membranes, forming a network-like structure."},
      {"q":"Which cell stores triglyceride in adipose tissue?","options":["Adipocyte","Fibroblast","Macrophage","Mast cell"],"correct":0,"rationale":"Adipocytes store energy as large triglyceride droplets and form adipose tissue."},
      {"q":"Mast cells release which mediator stored in granules?","options":["Histamine","Insulin","Thrombin","Collagenase"],"correct":0,"rationale":"Mast cell granules contain histamine, heparin and other mediators involved in inflammation and allergy."},
      {"q":"Which structure anchors epithelium to connective tissue?","options":["Hemidesmosome","Desmosome","Gap junction","Tight junction"],"correct":0,"rationale":"Hemidesmosomes attach basal epithelial cells to the underlying basement membrane and connective tissue."},
      {"q":"Which cartilage is avascular and heals poorly?","options":["Hyaline cartilage","Elastic cartilage","Fibrocartilage","Bone"],"correct":0,"rationale":"Hyaline cartilage is avascular and receives nutrients by diffusion, leading to limited repair capacity."},
      {"q":"Which cell type forms collagen in cartilage?","options":["Chondrocyte","Osteoblast","Fibroblast","Adipocyte"],"correct":0,"rationale":"Chondrocytes produce cartilage-specific extracellular matrix including type II collagen and proteoglycans."},
      {"q":"Which tooth tissue arises from ectoderm?","options":["Dentin","Enamel","Cementum","Dental pulp"],"correct":1,"rationale":"Enamel is produced by ameloblasts of ectodermal origin; dentin and pulp are mesenchymal (neural crest) derivatives."},
      {"q":"Which cell is the resident macrophage in liver?","options":["Kupffer cell","Hepatocyte","Ito cell","Chondrocyte"],"correct":0,"rationale":"Kupffer cells are hepatic macrophages lining sinusoidal channels and clearing debris and pathogens."},
      {"q":"Pancreatic islets contain alpha cells that produce:","options":["Insulin","Glucagon","Somatostatin","Pancreatic polypeptide"],"correct":1,"rationale":"Alpha cells synthesize glucagon, which raises blood glucose; beta cells produce insulin."},
      {"q":"Which epithelial specialization increases surface area for absorption?","options":["Stereocilia","Microvilli","Cilia","Keratinization"],"correct":1,"rationale":"Microvilli, with actin cores, greatly increase apical surface area to enhance absorption (e.g., intestinal epithelium)."},
      {"q":"Which junction allows direct electrical coupling between cells?","options":["Tight junction","Desmosome","Gap junction","Adherens junction"],"correct":2,"rationale":"Gap junctions are channels composed of connexins allowing ionic and small molecule passage for electrical coupling."},
      {"q":"Which immunoglobulin is transported across epithelium to mucosal surfaces?","options":["IgM","IgG","IgA","IgE"],"correct":2,"rationale":"Secretory IgA is transported across epithelium to mucosal surfaces protecting against pathogens."},
      {"q":"Which collagen predominates in tendons and ligaments?","options":["Type II","Type IV","Type I","Type III"],"correct":2,"rationale":"Type I collagen forms thick fibrils that provide tensile strength in tendons and ligaments."},
      {"q":"Which cell is the main phagocytic cell in connective tissue?","options":["Fibroblast","Macrophage","Mast cell","Adipocyte"],"correct":1,"rationale":"Macrophages are resident phagocytic cells that engulf debris and pathogens and orchestrate immune responses."},
      {"q":"Which component forms the core of elastic fibers?","options":["Collagen","Elastin","Proteoglycan","Keratin"],"correct":1,"rationale":"Elastin forms the core of elastic fibers, providing recoil; microfibrils (fibrillin) form the scaffold."},
      {"q":"Which stain highlights glycogen and mucosubstances?","options":["H&E","PAS","Silver stain","Trichrome"],"correct":1,"rationale":"PAS (Periodic acid–Schiff) reaction stains glycogen and carbohydrate-rich mucosubstances magenta."},
      {"q":"Which epithelium lines the small intestine?","options":["Stratified squamous","Simple cuboidal","Simple columnar with microvilli","Pseudostratified columnar"],"correct":2,"rationale":"The small intestine is lined by simple columnar epithelium with microvilli (brush border) for absorption."},
      {"q":"Which cell junction uses cadherins to mediate adhesion?","options":["Tight junction","Desmosome and adherens junction","Gap junction","Hemidesmosome"],"correct":1,"rationale":"Cadherins mediate calcium-dependent adhesion in adherens junctions (zonula adherens) and desmosomes (macula adherens)."},
      {"q":"Which connective tissue cell participates in allergic responses?","options":["Fibroblast","Mast cell","Chondrocyte","Osteocyte"],"correct":1,"rationale":"Mast cells contain histamine and other mediators and play key roles in immediate hypersensitivity and inflammation."},
      {"q":"Which epithelium lines the urinary bladder?","options":["Simple squamous","Stratified squamous","Transitional (urothelium)","Pseudostratified columnar"],"correct":2,"rationale":"Urothelium (transitional epithelium) with umbrella cells is specialized for stretch and impermeability in the bladder."},
      {"q":"Which connective tissue fiber provides stretch and recoil?","options":["Type I collagen","Type III collagen","Elastin","Reticular fibers"],"correct":2,"rationale":"Elastic fibers with elastin provide stretch and elastic recoil (e.g., elastic arteries, lung tissue)."},
      {"q":"Which structure forms the glomerular filtration barrier?","options":["Endothelium only","Basement membrane only","Podocyte foot processes + basement membrane + fenestrated endothelium","Mesangial cells only"],"correct":2,"rationale":"The glomerular filtration barrier comprises fenestrated endothelium, the glomerular basement membrane, and podocyte slit diaphragms."},
      {"q":"Which bone cell resides in lacunae?","options":["Osteoblast","Osteoclast","Osteocyte","Chondrocyte"],"correct":2,"rationale":"Osteocytes are mature bone cells residing in lacunae with dendritic processes in canaliculi."},
      {"q":"Which epithelial gland produces mucous secretion?","options":["Serous gland","Mucous gland","Sebaceous gland","Endocrine gland"],"correct":1,"rationale":"Mucous glands produce viscous, glycoprotein-rich secretions (mucus) often via merocrine mode."},
      {"q":"Which tissue has the slowest turnover?","options":["Epidermis","Intestinal epithelium","Cartilage","Oral mucosa"],"correct":2,"rationale":"Cartilage is avascular and has low cell turnover and limited regenerative capacity compared with epithelial tissues."},
      {"q":"Which of the following binds oxygen in skeletal muscle?","options":["Hemoglobin","Myoglobin","Collagen","Elastin"],"correct":1,"rationale":"Myoglobin stores and facilitates oxygen diffusion in muscle fibers; hemoglobin transports oxygen in blood."},
      {"q":"What structure anchors the sarcomere at its midpoint?","options":["Z disc","M line","A band","I band"],"correct":1,"rationale":"The M line stabilizes thick filaments at the center of the sarcomere, while Z discs define sarcomere boundaries."},
      {"q":"Which epithelium lines airways and has cilia?","options":["Stratified squamous","Simple columnar with microvilli","Pseudostratified ciliated columnar with goblet cells","Transitional"],"correct":2,"rationale":"Respiratory epithelium is pseudostratified ciliated columnar containing goblet cells that produce mucus and cilia that move it."},
      {"q":"Which connective tissue is specialized for fat storage?","options":["Dense regular","Loose areolar","Adipose tissue","Hyaline cartilage"],"correct":2,"rationale":"Adipose tissue stores triglycerides in adipocytes and serves for energy storage and insulation."},
      {"q":"Which cell contributes to fibrosis by secreting collagen after injury?","options":["Neutrophil","Fibroblast","Macrophage","Endothelial cell"],"correct":1,"rationale":"Fibroblasts proliferate and produce collagen and ECM in wound healing leading to fibrosis and scar formation."},
      {"q":"Which gland has holocrine secretion?","options":["Eccrine sweat gland","Sebaceous gland","Parotid salivary gland","Lacrimal gland"],"correct":1,"rationale":"Sebaceous glands undergo holocrine secretion where whole cells disintegrate to release sebum."},
      {"q":"Which epithelium provides a barrier to water loss?","options":["Simple squamous","Keratinized stratified squamous","Simple columnar","Pseudostratified columnar"],"correct":1,"rationale":"Keratinized stratified squamous epithelium (skin) forms an effective barrier against water loss due to keratin and lipid matrix."},
      {"q":"Which cell type produces surfactant in the lung?","options":["Type I pneumocyte","Type II pneumocyte","Goblet cell","Clara cell"],"correct":1,"rationale":"Type II pneumocytes synthesize and secrete surfactant which reduces alveolar surface tension."},
      {"q":"Which organelle is abundant in steroid-secreting cells?","options":["Rough ER","Smooth ER","Mitochondria","Lysosome"],"correct":1,"rationale":"Smooth endoplasmic reticulum is involved in lipid and steroid synthesis and is abundant in steroidogenic cells."},
      {"q":"Which junction provides mechanical coupling between epithelial cells?","options":["Tight junctions","Gap junctions","Desmosomes (macula adherens)","Clathrin-coated pits"],"correct":2,"rationale":"Desmosomes (macula adherens) provide strong mechanical adhesion between cells via intermediate filaments."},
      {"q":"Which cell type synthesizes myelin in the PNS?","options":["Schwann cell","Oligodendrocyte","Astrocyte","Microglia"],"correct":0,"rationale":"Schwann cells myelinate individual axons in the peripheral nervous system, providing insulation for rapid conduction."},
      {"q":"Which tissue is highly vascularized and supports bone marrow?","options":["Compact bone","Cortical bone","Spongy bone (trabecular)","Hyaline cartilage"],"correct":2,"rationale":"Spongy (trabecular) bone contains spaces filled with bone marrow and is more vascular than compact bone."},
      {"q":"Which collagen is found in cartilage?","options":["Type I","Type II","Type IV","Type III"],"correct":1,"rationale":"Cartilage matrix predominantly contains type II collagen providing tensile strength to the matrix."},
      {"q":"Which cell secretes digestive enzymes in pancreas?","options":["Islet alpha cell","Acinar cell","Ductal cell","Goblet cell"],"correct":1,"rationale":"Pancreatic acinar cells synthesize and secrete digestive enzymes into ducts for digestion."},
      {"q":"Which cell type is involved in antigen presentation in lymph nodes?","options":["Neutrophil","Dendritic cell","Erythrocyte","Chondrocyte"],"correct":1,"rationale":"Dendritic cells capture antigens and present them to T cells in lymph nodes to initiate immune responses."},
      {"q":"Which tissue is characterized by abundant ground substance and sparse fibers (e.g., Wharton's jelly)?","options":["Dense regular CT","Adipose tissue","Loose mucoid connective tissue","Hyaline cartilage"],"correct":2,"rationale":"Mucoid connective tissue (embryonic/Wharton’s jelly) has abundant ground substance and is gelatinous in consistency."},
      {"q":"Which protein cross-links collagen fibers providing tensile strength?","options":["Elastin","Lysyl oxidase-mediated cross-links","Proteoglycan core proteins","Fibronectin"],"correct":1,"rationale":"Lysyl oxidase catalyzes oxidative deamination leading to covalent cross-links between collagen molecules, increasing tensile strength."},
      {"q":"Which hepatic cell stores vitamin A?","options":["Kupffer cell","Hepatocyte","Ito (stellate) cell","Sinusoidal endothelial cell"],"correct":2,"rationale":"Ito (stellate) cells store vitamin A in lipid droplets and can differentiate into myofibroblasts in liver injury."},
      {"q":"Which epithelium lines the fallopian tube and has ciliated cells?","options":["Stratified squamous","Simple columnar ciliated","Pseudostratified","Transitional"],"correct":1,"rationale":"The fallopian tube is lined by ciliated simple columnar epithelium that aids ovum transport."},
      {"q":"Which gland is purely endocrine?","options":["Parotid gland","Thyroid gland","Sebaceous gland","Eccrine sweat gland"],"correct":1,"rationale":"The thyroid is an endocrine gland releasing hormones (thyroxine) into the bloodstream rather than ducts."},
      {"q":"Which ECM protein mediates cell adhesion to the matrix via integrins?","options":["Collagen","Fibronectin","Elastin","Keratin"],"correct":1,"rationale":"Fibronectin binds integrins on cell surfaces, linking cells to the extracellular matrix."},
      {"q":"Which cell type lines lymphatic sinuses and has discontinuous basal lamina?","options":["Endothelial cells of sinusoids","Kupffer cells","Chondrocytes","Hepatocytes"],"correct":0,"rationale":"Sinusoidal endothelial cells (e.g., liver sinusoids) have fenestrations and discontinuous basal lamina allowing exchange between blood and tissue."},
      {"q":"Which tissue forms the intervertebral disc nucleus pulposus?","options":["Elastic cartilage","Fibrocartilage","Hyaline cartilage","Adipose tissue"],"correct":1,"rationale":"The nucleus pulposus is rich in proteoglycans and has fibrocartilage-like properties providing compressive resistance."},
      {"q":"Which cell secretes mucous in the tracheobronchial tree?","options":["Type II pneumocyte","Clara (Club) cell","Goblet cell","Pseudostratified ciliated cell"],"correct":2,"rationale":"Goblet cells produce mucous in the airways that traps particles and pathogens; Clara/Club cells have other protective roles."},
      {"q":"Which structure forms during skeletal muscle injury to repair tissue?","options":["Fibrosis with scar formation","New bone formation","Cartilage deposition","Regeneration without fibrosis"],"correct":0,"rationale":"Severe skeletal muscle injury often results in fibrosis where fibroblasts deposit collagen forming scar tissue."},
      {"q":"Which cell junction anchors actin filaments across adjacent cells?","options":["Desmosome","Hemidesmosome","Adherens junction (zonula adherens)","Gap junction"],"correct":2,"rationale":"Adherens junctions (zonula adherens) link actin filaments between adjacent cells via cadherins."},
      {"q":"Which organelle is the major site of ATP production?","options":["RER","Golgi apparatus","Mitochondrion","Lysosome"],"correct":2,"rationale":"Mitochondria generate ATP through oxidative phosphorylation and are abundant in energy-demanding cells."},
      {"q":"Which capillary type is most permeable (e.g., in liver)?","options":["Continuous","Fenestrated","Discontinuous (sinusoidal)","Tight junction-rich"],"correct":2,"rationale":"Discontinuous sinusoids have large gaps and basal lamina discontinuities, allowing high exchange in organs like liver."},
      {"q":"Which connective tissue is adapted for force transmission in one direction (tendons)?","options":["Dense irregular","Dense regular","Loose areolar","Adipose"],"correct":1,"rationale":"Dense regular connective tissue has parallel collagen bundles aligned to resist tensile forces in a single direction, as in tendons."},
      {"q":"Which cell coordinates neuronal repair and scarring in CNS?","options":["Oligodendrocyte","Astrocyte","Microglia","Schwann cell"],"correct":1,"rationale":"Astrocytes form glial scars and modulate repair in CNS after injury; they also regulate the extracellular environment."},
      {"q":"Which pigment is produced by melanocytes and transferred to keratinocytes?","options":["Lipopigment","Melanin","Hemosiderin","Biliverdin"],"correct":1,"rationale":"Melanocytes synthesize melanin and transfer pigment to neighboring keratinocytes, providing photoprotection."},
      {"q":"Which feature distinguishes pseudostratified from stratified epithelium?","options":["All cells touch the basal lamina but nuclei at different levels","Multiple layers of cells","A single apical layer only","Presence of keratin"],"correct":0,"rationale":"In pseudostratified epithelium all cells contact the basal lamina though nuclei are at different levels, giving a multilayered appearance."},
      {"q":"Which cells form the blood-brain barrier tight junctions?","options":["Neurons","Endothelial cells","Astrocyte foot processes","Oligodendrocytes"],"correct":1,"rationale":"Tight junctions between cerebral endothelial cells create the blood-brain barrier, with support from astrocyte endfeet."},
      {"q":"Which tissue type regenerates effectively after mild injury?","options":["Hyaline cartilage","Skeletal muscle","Liver (hepatocytes)","Cardiac muscle"],"correct":2,"rationale":"The liver has remarkable regenerative capacity due to hepatocyte proliferation, unlike cartilage or cardiac muscle."},
      {"q":"Which epithelial modification is characteristic of absorptive cells in intestine?","options":["Stereocilia","Microvilli (brush border)","Cilia","Keratinization"],"correct":1,"rationale":"Enterocytes have densely packed microvilli forming a brush border to maximize surface area for nutrient absorption."},
      {"q":"Which connective tissue fiber stains with orcein?","options":["Collagen I","Reticular fiber","Elastic fiber","Type IV collagen"],"correct":2,"rationale":"Orcein and other elastic stains highlight elastic fibers by binding to elastin."},
      {"q":"Which cell type mediates chronic inflammation and remodeling?","options":["Neutrophil","Macrophage","Eosinophil","Basophil"],"correct":1,"rationale":"Macrophages orchestrate chronic inflammation, secrete cytokines, and participate in tissue remodeling and repair."},
      {"q":"Which structure in kidney filters blood plasma?","options":["Proximal tubule","Glomerulus","Collecting duct","Loop of Henle"],"correct":1,"rationale":"The glomerulus is the capillary network that filters plasma into Bowman's space forming primary urine."},
      {"q":"Which gland surrounds hair follicles and secretes sebum?","options":["Eccrine sweat gland","Sebaceous gland","Apocrine sweat gland","Salivary gland"],"correct":1,"rationale":"Sebaceous glands are associated with hair follicles and produce sebum that conditions hair and skin."},
      {"q":"Which cell forms cartilage matrix?","options":["Chondroblast/chondrocyte","Osteoblast","Fibroblast","Adipocyte"],"correct":0,"rationale":"Chondroblasts produce cartilage matrix during growth and differentiate into chondrocytes that maintain cartilage."},
      {"q":"Which tissue type has a lot of ground substance but few fibers?","options":["Dense connective tissue","Mucoid connective tissue","Bone","Hyaline cartilage"],"correct":1,"rationale":"Mucoid (embryonic) connective tissue has abundant ground substance and few fibers, providing a gelatinous matrix."},
      {"q":"Which receptor is specialized for sustained pressure and skin stretch?","options":["Pacinian corpuscle","Meissner corpuscle","Ruffini ending","Merkel cell"],"correct":2,"rationale":"Ruffini endings detect skin stretch and sustained pressure, contributing to proprioception and touch."},
      {"q":"Which hepatic cell removes senescent red cells and debris?","options":["Kupffer cell","Hepatocyte","Ito cell","Endothelial sinusoidal cell"],"correct":0,"rationale":"Kupffer cells are liver macrophages lining sinusoids that phagocytose senescent red blood cells and debris."},
      {"q":"Which epithelium tolerates stretching and recoiling (urinary bladder)?","options":["Simple squamous","Stratified squamous","Transitional epithelium","Pseudostratified ciliated"],"correct":2,"rationale":"Transitional epithelium (urothelium) accommodates distension and relaxation in the urinary tract."},
      {"q":"Which molecular structure composes microvilli core?","options":["Microtubules","Actin filaments","Intermediate filaments","Myosin"],"correct":1,"rationale":"Microvilli cores contain bundled actin filaments that support the protrusion and cellulose-like structure of the brush border."},
      {"q":"Which cell junction allows passage of ions between cardiomyocytes?","options":["Tight junction","Desmosome","Gap junction","Adherens junction"],"correct":2,"rationale":"Gap junctions permit ionic exchange enabling coordinated depolarization and contraction of cardiac muscle."},
      {"q":"Which structure attaches epithelium to connective tissue?","options":["Desmosome","Hemidesmosome","Tight junction","Gap junction"],"correct":1,"rationale":"Hemidesmosomes attach basal epithelial cells to the basement membrane and underlying connective tissue."},
      {"q":"Which cartilage type resists compressive forces in intervertebral discs?","options":["Elastic cartilage","Fibrocartilage","Hyaline cartilage","Bone"],"correct":1,"rationale":"Fibrocartilage has dense collagen bundles and resists compressive and shear forces (e.g., disc, pubic symphysis)."},
      {"q":"Which gland secretes watery secretion by exocytosis in the skin?","options":["Sebaceous gland","Eccrine sweat gland","Apocrine gland","Mammary gland"],"correct":1,"rationale":"Eccrine sweat glands secrete watery sweat via merocrine (exocytotic) mechanism and regulate thermoregulation."},
      {"q":"Which protein forms basement membrane network with laminin?","options":["Type I collagen","Type IV collagen","Elastin","Keratin"],"correct":1,"rationale":"Type IV collagen forms a nonfibrillar network in basement membranes interacting with laminin for structural integrity."},
      {"q":"Which structures in lymph node filter lymph and house macrophages?","options":["Germinal centers","Medullary sinuses","Trabeculae","Follicles"],"correct":1,"rationale":"Medullary sinuses in lymph nodes contain macrophages and filter lymph before it exits via efferent vessels."},
      {"q":"Which cell in kidney concentrates urine via countercurrent exchange?","options":["Glomerular endothelial cell","Loop of Henle cells","Macula densa","Podocyte"],"correct":1,"rationale":"Cells of the loop of Henle establish osmotic gradients essential for water reabsorption and urine concentration."},
      {"q":"Which tissue forms the dermal papillae and houses capillaries for epidermis?","options":["Hypodermis","Papillary dermis (loose CT)","Reticular dermis (dense CT)","Epidermis"],"correct":1,"rationale":"Papillary dermis is loose connective tissue that forms dermal papillae supplying nutrients and thermoregulation to the avascular epidermis."},
      {"q":"Which cell in pancreas secretes insulin?","options":["Alpha cell","Beta cell","Delta cell","PP cell"],"correct":1,"rationale":"Pancreatic beta cells in islets of Langerhans secrete insulin to lower blood glucose."},
      {"q":"Which feature distinguishes skeletal from cardiac muscle?","options":["Mononucleate cells","Intercalated discs and branching","Lack of striations","Presence of junctions"],"correct":1,"rationale":"Cardiac muscle cells are branched and connected by intercalated discs; skeletal muscle fibers are long, cylindrical, multinucleated and not branched."},
      {"q":"Which cell type lines lymphatic vessels?","options":["Continuous endothelium","Fenestrated endothelium","Lymphatic endothelial cells with anchoring filaments","Keratinocytes"],"correct":2,"rationale":"Lymphatic endothelium has anchoring filaments and overlapping flaps facilitating interstitial fluid uptake."},
      {"q":"Which cell detects light touch and is associated with Merkel discs?","options":["Meissner corpuscle","Merkel cell","Pacinian corpuscle","Ruffini ending"],"correct":1,"rationale":"Merkel cells are mechanoreceptors forming Merkel discs with nerve endings for light touch and texture discrimination."},
      {"q":"Which extracellular matrix molecule is key to cell migration and wound healing?","options":["Collagen I","Fibronectin","Elastin","Keratan sulfate"],"correct":1,"rationale":"Fibronectin binds integrins and acts as a scaffold guiding cell migration and tissue repair during wound healing."},
      {"q":"Which cell in CNS myelinates multiple axons?","options":["Schwann cell","Oligodendrocyte","Astrocyte","Ependymal cell"],"correct":1,"rationale":"Oligodendrocytes myelinate multiple CNS axons; Schwann cells myelinate single PNS axons."},
      {"q":"Which epithelial appendage is derived from epidermal downgrowths?","options":["Sweat glands","Hair follicles","Nails","All of the above"],"correct":3,"rationale":"Epidermal downgrowths form hair follicles, sweat glands, and nails — cutaneous appendages arising from ectoderm."},
      {"q":"Which cell type produces extracellular matrix in cartilage?","options":["Chondroblast","Chondrocyte","Fibroblast","Osteoblast"],"correct":0,"rationale":"Chondroblasts synthesize cartilage matrix during growth and maturation, then become chondrocytes embedded in lacunae."}
      /* End of 200 questions — the array above contains 200 items in total. */
    ]
  }
};

/* =========================
   APP: rendering & rationale
   ========================= */
(function(){
  function letterFor(i){ return String.fromCharCode(65 + i); }

  function renderCatalog(){
    const container = document.getElementById('quiz-catalog');
    container.innerHTML = '<h3 style="color:#6ee7b7;margin:0 0 8px 0">Available Exams</h3>';
    Object.keys(quizzes).forEach(id => {
      const q = quizzes[id];
      const entry = document.createElement('div');
      entry.className = 'quiz-entry';
      entry.innerHTML = `<div style="font-weight:700;color:#e6eef3">${q.title || id}</div><div style="color:#9aa6b2;font-size:12px">id: ${q.id}</div>`;
      entry.addEventListener('click', () => loadQuizFromObject(id));
      container.appendChild(entry);
    });
  }

  function loadQuizFromObject(id){
    const q = quizzes[id];
    if (!q) {
      document.getElementById('questions').innerHTML = `<p style="color:#f88">Quiz "${id}" not found.</p>`;
      return;
    }
    document.getElementById('pageTitle').textContent = q.title || id;
    window.questions = q.questions || [];
    renderQuestions();
  }

  function renderQuestions(){
    const qContainer = document.getElementById('questions');
    qContainer.innerHTML = '';
    window.answered = 0;
    window.correctCount = 0;
    const qs = window.questions || [];
    qs.forEach((item, idx) => {
      const qDiv = document.createElement('div');
      qDiv.className = 'question';
      qDiv.id = 'q' + idx;
      qDiv.innerHTML = `
        <div class="qhead">
          <div class="qnum">${idx+1}</div>
          <div class="qtext">
            <div style="font-weight:700">${item.q}</div>
            <div class="opts" id="opts${idx}"></div>
          </div>
        </div>
        <div class="rationale" id="rat${idx}"></div>
      `;
      qContainer.appendChild(qDiv);
      const optsDiv = qDiv.querySelector(`#opts${idx}`);
      (item.options || []).forEach((opt, oi) => {
        const b = document.createElement('div');
        b.className = 'opt';
        b.setAttribute('data-qi', idx);
        b.setAttribute('data-oi', oi);
        b.tabIndex = 0;
        b.innerHTML = `<strong>${letterFor(oi)}.</strong> ${opt}`;
        b.addEventListener('click', handleClick);
        optsDiv.appendChild(b);
      });
    });
    document.getElementById('progress').textContent = `Answered: 0 / ${window.questions.length}`;
    document.getElementById('score').textContent = `Score: 0`;
  }

  function handleClick(e){
    const el = e.currentTarget;
    const qi = parseInt(el.getAttribute('data-qi'));
    const oi = parseInt(el.getAttribute('data-oi'));
    const item = window.questions[qi];
    const qdiv = document.getElementById('q' + qi);
    if (qdiv.getAttribute('data-answered') === 'true') return;
    qdiv.setAttribute('data-answered','true');
    window.answered++;
    const opts = qdiv.querySelectorAll('.opt');

    if (oi === item.correct) {
      el.classList.add('correct');
      window.correctCount++;
    } else {
      el.classList.add('incorrect');
      opts.forEach(node => {
        if (parseInt(node.getAttribute('data-oi')) === item.correct) {
          node.classList.add('correct');
        }
      });
    }

    opts.forEach(node => {
      node.style.pointerEvents = 'none';
      node.setAttribute('aria-disabled','true');
    });

    let raw = (item.rationale || '').trim();
    raw = raw.replace(/\n\s*Source:[\s\S]*$/i,'').replace(/\n\s*Answer:\s*[A-D]/i,'').trim();
    if (!raw) raw = 'This choice best matches the central concept tested in the question.';

    let final = 'Why this answer is correct:\n\n';
    const sentences = raw.split(/(?<=\.)\s+/).filter(Boolean);
    if (sentences.length > 0) {
      final += sentences.slice(0,2).join(' ') + '\n\n';
      if (sentences.length > 2) final += sentences.slice(2).join(' ') + '\n\n';
    } else {
      final += raw + '\n\n';
    }
    final += 'Why the other choices are not correct:\n\n';
    (item.options || []).forEach((opt, idx)=>{
      if (idx === item.correct) return;
      final += `${letterFor(idx)}. ${opt} — ${generateOtherReason(opt, raw, idx, item.correct)}\n\n`;
    });

    const rat = document.getElementById('rat' + qi);
    rat.textContent = final.trim();
    rat.classList.add('show');

    document.getElementById('progress').textContent = `Answered: ${window.answered} / ${window.questions.length}`;
    document.getElementById('score').textContent = `Score: ${window.correctCount}`;
    rat.scrollIntoView({behavior:'smooth', block:'nearest'});
  }

  function generateOtherReason(optText, correctRationale, distractorIndex, correctIndex){
    const ot = (optText || '').toLowerCase();
    const crFirst = (correctRationale || '').split(/[.?!]/).filter(Boolean)[0] || 'the main point above';
    const templates = [
      `This option is incorrect because it does not include the essential feature described above: ${crFirst}. It addresses a related idea but omits or contradicts the specific requirement.`,
      `This choice confuses two concepts: it describes something related but not the same as the correct answer. The correct answer directly addresses ${crFirst}, whereas this option does not.`,
      `This alternative is incorrect because it contradicts the central point of the correct explanation; it asserts the opposite or fails to meet the necessary condition.`,
      `This answer is too general or incomplete relative to the correct choice. The correct answer specifies ${crFirst}, while this option lacks that necessary specificity.`,
      `This option applies to a different context or structure and therefore is not the correct response to this question; it does not meet the precise criteria explained above.`
    ];
    if (ot.includes('mitochondr') && /dna|mitochondrial/i.test(correctRationale) === false) {
      return `This option mentions mitochondria, but the question concerns a different structure or functional point (${crFirst}).`;
    }
    if (ot.includes('collagen') && /collagen/i.test(correctRationale) === false) {
      return `This distractor focuses on collagen, but the correct rationale concerns ${crFirst}, not the collagen-related property cited here.`;
    }
    if (ot.includes('keratin') && /keratin/i.test(correctRationale) === false) {
      return `This choice refers to keratin, but the correct rationale focuses on ${crFirst} rather than keratin-related features.`;
    }
    const idx = Math.abs(distractorIndex + optText.length) % templates.length;
    return templates[idx];
  }

  function initFromQuery(){
    const params = new URLSearchParams(window.location.search);
    const qid = params.get('quiz');
    renderCatalog();
    if (qid && quizzes[qid]) { loadQuizFromObject(qid); return; }
    const first = Object.keys(quizzes)[0];
    if (first) loadQuizFromObject(first);
  }

  document.getElementById('showScore').addEventListener('click', ()=>{
    alert(`Answered ${window.answered} of ${window.questions.length}.\nCorrect: ${window.correctCount}`);
  });
  document.getElementById('resetBtn').addEventListener('click', ()=> {
    if (!confirm('Reset all answers?')) return;
    initFromQuery();
  });

  document.addEventListener('DOMContentLoaded', initFromQuery);
})();
async function loadQuizFileEntry(entry) {
  // entry.file may be a relative path (quizzes/quiz1.json) or an absolute raw URL
  const url = (entry.file || '').startsWith('http') ? entry.file : `/quizzes/${entry.file}`;
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error('Quiz file not found: ' + res.status);
    const quiz = await res.json();
    document.getElementById('pageTitle').textContent = entry.title || quiz.title || entry.id;
    window.questions = quiz.questions || [];
    if (typeof render === 'function') {
      render();
    } else if (typeof renderQuestionsSimple === 'function') {
      renderQuestionsSimple(window.questions);
    } else {
      // fallback: reinitialize catalog -> load questions directly
      if (window.questions && window.questions.length) {
        // call existing renderer that your page uses
        renderQuestions(); // only if you have it
      }
    }
  } catch (err) {
    console.error('Failed to load quiz:', err);
    const qContainer = document.getElementById('questions');
    if (qContainer) qContainer.innerHTML = `<p style="color:#f88">Failed to load quiz ${entry.id}.</p>`;
  }
}
/* ---------- Catalog loader + quiz loader (paste before </script> in index.html) ---------- */

async function fetchAndRenderCatalog() {
  const catalogUrl = '/quizzes/quizzes.json';
  try {
    const res = await fetch(catalogUrl);
    if (!res.ok) {
      console.warn('Catalog not found at', catalogUrl, 'status', res.status);
      const container = ensureCatalogContainer();
      container.innerHTML = '<h3 style="color:#6ee7b7;margin:0 0 8px 0">Available Exams</h3><div style="color:#9aa6b2">No catalog found (quizzes/quizzes.json).</div>';
      return;
    }
    const list = await res.json();
    renderCatalogFromList(list);
  } catch (err) {
    console.error('Failed to fetch catalog:', err);
    const container = ensureCatalogContainer();
    container.innerHTML = '<h3 style="color:#6ee7b7;margin:0 0 8px 0">Available Exams</h3><div style="color:#f88">Error loading catalog.</div>';
  }
}

function ensureCatalogContainer(){
  let container = document.getElementById('quiz-catalog');
  if (container) return container;
  container = document.createElement('aside');
  container.id = 'quiz-catalog';
  container.style = 'width:280px;float:left;margin-right:18px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);';
  container.innerHTML = '<h3 style="color:#6ee7b7;margin:0 0 8px 0">Available Exams</h3>';
  const mainCard = document.querySelector('.exam-card');
  if (mainCard && mainCard.parentNode) {
    mainCard.parentNode.insertBefore(container, mainCard);
  } else {
    document.body.insertBefore(container, document.body.firstChild);
  }
  return container;
}

function renderCatalogFromList(list) {
  const container = ensureCatalogContainer();
  container.innerHTML = '<h3 style="color:#6ee7b7;margin:0 0 8px 0">Available Exams</h3>';
  list.forEach(entry => {
    const id = entry.id || (entry.file && entry.file.replace(/[^\w\-\.]/g,'_')) || 'quiz';
    const title = entry.title || id;
    const node = document.createElement('div');
    node.className = 'quiz-entry';
    node.style = 'padding:8px 6px;border-bottom:1px solid rgba(255,255,255,0.03);cursor:pointer';
    node.innerHTML = `<div style="font-weight:700;color:#e6eef3">${title}</div><div style="color:#9aa6b2;font-size:12px">${entry.id || ''}</div>`;
    node.addEventListener('click', () => {
      if (entry.file) {
        loadQuizFileEntry(entry);
      } else {
        console.warn('Catalog entry has no file:', entry);
      }
    });
    container.appendChild(node);
  });
  if (list.length > 0) {
    const params = new URLSearchParams(window.location.search);
    if (!params.get('quiz')) {
      const first = list[0];
      if (first && first.file) loadQuizFileEntry(first);
    }
  }
}

async function loadQuizFileEntry(entryOrUrl) {
  const entry = (typeof entryOrUrl === 'string') ? { file: entryOrUrl } : entryOrUrl;
  let url = entry.file || '';
  if (!url.startsWith('http')) {
    url = '/' + url.replace(/^\/+/, '');
  }
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error('Quiz file not found: ' + res.status);
    const quiz = await res.json();
    if (document.getElementById('pageTitle')) {
      document.getElementById('pageTitle').textContent = quiz.title || entry.title || 'Quiz';
    }
    window.questions = quiz.questions || [];
    renderQuestions();
  } catch (err) {
    console.error('Failed to load quiz:', err);
    const qContainer = document.getElementById('questions');
    if (qContainer) qContainer.innerHTML = `<p style="color:#f88">Failed to load quiz${entry && entry.id ? ' ' + entry.id : ''}.</p>`;
  }
}

/* --- fallback renderer (only if site lacks one) --- */
if (typeof renderQuestions === 'undefined') {
  function letterFor(i){ return String.fromCharCode(65 + i); }

  function renderQuestions(){
    const qContainer = document.getElementById('questions');
    qContainer.innerHTML = '';
    window.answered = 0;
    window.correctCount = 0;
    const qs = window.questions || [];
    qs.forEach((item, idx) => {
      const qDiv = document.createElement('div');
      qDiv.className = 'question';
      qDiv.id = 'q' + idx;
      const imgHtml = item.image ? `<div style="margin:10px 0;text-align:center"><img src="${item.image}" alt="fig ${idx+1}" style="max-width:100%;height:auto;border-radius:6px;border:1px solid rgba(255,255,255,0.05)"></div>` : '';
      qDiv.innerHTML = `
        <div class="qhead">
          <div class="qnum">${idx+1}</div>
          <div class="qtext">
            <div style="font-weight:700">${item.q}</div>
            ${imgHtml}
            <div class="opts" id="opts${idx}"></div>
          </div>
        </div>
        <div class="rationale" id="rat${idx}"></div>
      `;
      qContainer.appendChild(qDiv);
      const optsDiv = qDiv.querySelector(`#opts${idx}`);
      (item.options || []).forEach((opt, oi) => {
        const b = document.createElement('div');
        b.className = 'opt';
        b.setAttribute('data-qi', idx);
        b.setAttribute('data-oi', oi);
        b.tabIndex = 0;
        b.innerHTML = `<strong>${letterFor(oi)}.</strong> ${opt}`;
        b.addEventListener('click', handleClick);
        optsDiv.appendChild(b);
      });
    });
    document.getElementById('progress').textContent = `Answered: 0 / ${window.questions.length}`;
    document.getElementById('score').textContent = `Score: 0`;
  }

  function handleClick(e){
    const el = e.currentTarget;
    const qi = parseInt(el.getAttribute('data-qi'));
    const oi = parseInt(el.getAttribute('data-oi'));
    const item = window.questions[qi];
    const qdiv = document.getElementById('q' + qi);
    if (qdiv.getAttribute('data-answered') === 'true') return;
    qdiv.setAttribute('data-answered','true');
    window.answered++;
    const opts = qdiv.querySelectorAll('.opt');

    if (oi === item.correct) {
      el.classList.add('correct');
      window.correctCount++;
    } else {
      el.classList.add('incorrect');
      opts.forEach(node => {
        if (parseInt(node.getAttribute('data-oi')) === item.correct) {
continue...
</script>
</body>
</html>


